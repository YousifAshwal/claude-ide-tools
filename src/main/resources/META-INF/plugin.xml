<idea-plugin>
    <id>com.igorlink.claudeidetools</id>
    <name>Claude IDE Tools</name>
    <vendor>Igor Link</vendor>
    <description><![CDATA[
        Exposes JetBrains IDE refactoring API via HTTP for Claude Code integration.
        <br/><br/>
        Features:
        <ul>
            <li>Rename refactoring (classes, methods, variables)</li>
            <li>Find usages across project</li>
            <li>Move class/package</li>
            <li>Extract method</li>
        </ul>
        <br/>
        HTTP server runs on localhost:8765 when IDE starts.
    ]]></description>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>

    <!-- Optional language support -->
    <depends optional="true" config-file="plugin-java.xml">com.intellij.java</depends>
    <depends optional="true" config-file="plugin-kotlin.xml">org.jetbrains.kotlin</depends>
    <depends optional="true" config-file="plugin-javascript.xml">JavaScript</depends>
    <depends optional="true" config-file="plugin-python.xml">com.intellij.modules.python</depends>
    <depends optional="true" config-file="plugin-go.xml">org.jetbrains.plugins.go</depends>
    <depends optional="true" config-file="plugin-rust.xml">org.rust.lang</depends>

    <applicationListeners>
        <listener
            class="com.igorlink.claudeidetools.McpPluginStartup"
            topic="com.intellij.ide.AppLifecycleListener"/>
        <listener
            class="com.igorlink.claudeidetools.McpPluginUnloadListener"
            topic="com.intellij.ide.plugins.DynamicPluginListener"/>
    </applicationListeners>

    <!-- Extension points for language-specific refactoring handlers -->
    <extensionPoints>
        <!-- Extension point for move refactoring handlers.
             Language plugins register handlers to support move operations.
             Handlers are discovered at runtime, avoiding ClassNotFoundException
             when language plugins are not available. -->
        <extensionPoint
            name="moveHandler"
            interface="com.igorlink.claudeidetools.extensions.MoveRefactoringExtension"
            dynamic="true"/>

        <!-- Extension point for extract method refactoring handlers.
             Language plugins register handlers to support extract method/function operations.
             Handlers are discovered at runtime, avoiding ClassNotFoundException
             when language plugins are not available. -->
        <extensionPoint
            name="extractMethodHandler"
            interface="com.igorlink.claudeidetools.extensions.ExtractMethodRefactoringExtension"
            dynamic="true"/>
    </extensionPoints>

    <extensions defaultExtensionNs="com.intellij">
        <applicationService
            serviceImplementation="com.igorlink.claudeidetools.services.McpHttpServerService"/>
        <applicationService
            serviceImplementation="com.igorlink.claudeidetools.services.PsiLocatorService"/>
        <applicationService
            serviceImplementation="com.igorlink.claudeidetools.services.McpAutoRegistrationService"/>
        <applicationService
            serviceImplementation="com.igorlink.claudeidetools.extensions.RefactoringExtensionService"/>
        <notificationGroup
            id="Claude IDE Tools"
            displayType="BALLOON"/>
    </extensions>

    <!-- Kotlin plugin compatibility: supports both K1 and K2 compilers -->
    <extensions defaultExtensionNs="org.jetbrains.kotlin">
        <supportsKotlinPluginMode supportsK2="true"/>
    </extensions>
</idea-plugin>
